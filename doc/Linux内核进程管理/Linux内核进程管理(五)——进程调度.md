# Linux内核进程管理(五)——进程调度

## 1. 调度策略

Linux内核作为一个通用操作系统，需要兼顾各种各样类型的进程，包括实时进程、交互式进程、批处理进程等。每种类型进程都有其特别的行为特征，总结如下：

1.   交互式进程： 与人机交互的进程，和鼠标、键盘、触摸屏等相关的应用，例如vim编辑器等，它们一直在睡眠同时等待用户召唤它们。这类进程的特点是系统响应时间越快越好，否则用户就会抱怨系统卡顿。
2.   批处理进程： 此类进程默默地工作和付出，可能会占用比较多的系统资源，例如编译代码等。
3.   实时进程： 有些应用对整体时延有严格要求，例如现在很火的`VR`设备，从头部转动到视频显示需要控制到19毫秒以内，否则会使人出现眩晕感。而对于工业控制系统，不符合要求的时延可能会导致严重的事故。

Linux内核支持的调度策略如下：

1.   限期进程使用限期调度策略（`SCHED_DEADLINE`）。
2.   实时进程支持两种调度策略：先进先出调度（`SCHED_FIFO`）和轮流调度（`SCHED_RR`）。
3.   普通进程支持两种调度策略：标准轮流分时（`SCHED_NORMAL`）和空闲（`SCHED_IDLE`）。以前普通进程还有一种调度策略，称为批量调度策略（`SCHED_BATCH`），Linux内核引入完全公平调度算法以后，批量调度策略被废弃了，等同于标准轮流分时策略。

>   限期调度策略有3个参数：运行事件`runtime`、截止期限`deadline`和周期`period`。如下图所示，每个周期运行一次，在截止期限之前执行完，依次运行的时间长度是`runtime`：

![image-20200412174926051](/home/haibin.xu/haibin/doc/picture/图 限期调度策略.PNG)

>   先进先出调度没有时间片，非常霸道，如果没有更高优先级的实时进度，并且它不睡眠，那么它将一直霸占处理器。

>   轮流调度有时间片，进程用完时间片以后加入优先级对应运行队列的尾部，把处理器让给优先级相同的其他实时进程。

>   标准轮流分时策略使用完全公平调度算法，把处理器时间公平地分配给每个进程。

>   空闲调度策略用来执行优先级非常低的后台作业，优先级比使用标准轮流分时策略和相对优先级为19的普通进程还要低，进程的相对优先级对空闲调度策略没有影响。



## 2. 进程优先级

限期进程优先级比实时进程高，实时进程的优先级比普通进程高。

限期进程的优先级是 -1 。

实时进程的实时优先级(`rt_priority`)是 0 ～ 99，实时优先级数值越大，表示优先级越高。

普通进程的静态优先级(`statuc_prio`)是 100 ～ 139，静态优先级数值越小，表示优先级越高，可通过修改`nice`值（即相对优先级，取值范围 -20 ～ 19）改变普通进程的优先级，优先级等于 120 + nice值。

